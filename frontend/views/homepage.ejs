<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Tournaments and Teams</title>
    <link rel="stylesheet" href="/assets/homePage.css">
    <script src="/assets/homepage.js" defer></script>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">MyWebsite</div>
        <div id="welcome-message"></div>
        <div class="search-profile">
            <form class="search-form" method="GET" action="/api/player/searchTournaments" onsubmit="return preprocessSearchInput()">
                <input type="text" id="search-input" name="searchTerm" placeholder="Search (use '?' for tournaments, '>' for teams)" required aria-label="Search tournaments and teams">
                <button type="submit">Search</button>
            </form>
            <a href="/dashboard">
            <img src="/assets/user.png" alt="Profile" class="profile-pic"></a>
        </div>
    </nav>

    <!-- Main container for the layout -->
    <div class="main-container">
        <!-- Left Column for tournaments -->
        <div class="left-column">
            <div class="searchResults" id="searchTournament">
                <h1>Tournament Results</h1>



<!-- Display search term for clarity -->
<% if (searchTerm) { %>
    <h2>Search Results for "<%= searchTerm %>"</h2>
<% } %>

<!-- Check if there are any results -->
<% if (results.length > 0) { %>
    <ul>
        <% results.forEach(tournament => { %>
            <li><%= tournament.name %> (ID: <%= tournament.tid %>)</li>
        <% }) %>
    </ul>
<% } else if (searchTerm) { %>
    <h3>No tournaments found for "<%= searchTerm %>"</h3>
<% } else { %>
    <h3>Please enter a tournament name to search.</h3>
<% } %>

                    </div>
                    <div id="loaded-tournament-data" style="display:block;">
                        <h2>Your Registered Tournaments</h2>
                        <% if (joinedTournaments && joinedTournaments.length > 0) { %>
                            <ul>
                                <% joinedTournaments.forEach(tournament => { %>
                                    <li><%= tournament.name %> (ID: <%= tournament._id %>)</li>
                                <% }) %>
                            </ul>
                        <% } else { %>
                            <p>You haven't registered for any tournaments yet.</p>
                        <% } %>
                    </div>
                    
                    <script>
                        // Optionally, you can show this section after a successful join
                        document.getElementById("loaded-tournament-data").style.display = "block";
                    </script>
                    
            </div>
        </div>
        
        <!-- Right Column for organizer and team results -->
        <div class="right-column">
            <div class="searchResults" id="searchOrg">
                <div class="heading">Organization Results</div>
                
                <form class="searchForm" method="GET" action="/api/player/searchOrganisers" onsubmit="return handleOrganizerSearch()">
                    <input type="text" name="searchTerm" id="organizer-search-input" placeholder="Search Organizations" required aria-label="Search organizations">
                    <button type="submit">Search Organizations</button>
                </form>
                <div id="organization-results" style="display:block;">
                    <h2>Organizer Results</h2>
                    <% if (organisationResults && organisationResults.length > 0) { %>
                        <ul>
                            <% organisationResults.forEach(organiser => { %>
                                <li>
                                    <strong>Name:</strong> <%= organiser.username %> (ID: <%= organiser._id %>)
                                    <form action="/api/player/followOrganiser" method="POST" style="display:inline;">
                                        <input type="hidden" name="organiserId" value="<%= organiser._id %>">
                                        <button type="submit" class="followButton">Follow Organizer</button>
                                    </form>
                                    <br>
                                    <strong>Tournaments:</strong>
                                    <ul>
                                        <% organiser.tournaments.forEach(tournament => { %>
                                            <li><%= tournament.name %> (ID: <%= tournament._id %>)</li>
                                        <% }); %>
                                    </ul>
                                </li>
                            <% }); %>
                        </ul>
                    <% } else { %>
                        <p>No organizers found matching your search.</p>
                    <% } %>
                </div>
                
                <div id="followed-organisers"></div>
            </div>

            
            <div class="searchResults" id="searchTeam">
                <div class="heading">Team Results</div>
                <div id="team-results" style="display:none;"></div>
                <div id="loaded-team-data" style="display:none;"></div>
            </div>
        </div>
    </div>
    
    <script src="/assets/homepage.js"></script>
</body>
</html>
